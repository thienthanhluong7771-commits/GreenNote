<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green-Note - Sổ Tay Nông Nghiệp AI</title>
    
    <!-- 1. Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Font chữ -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- 3. Cấu hình Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <!-- 4. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .font-logo { font-family: 'Pacifico', cursive; }
        .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        
        /* Custom scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Chat bubble animation */
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .chat-bubble { animation: popIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-white text-slate-800 selection:bg-green-100 selection:text-green-800">
    
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { ChevronLeft, Leaf, Droplets, Sun, Calendar, Info, Sprout, Wind, Thermometer, Search, ArrowRight, Shovel, Bug, ShieldAlert, Beaker, Menu, X, TestTube, Home, Sparkles, Send, MessageSquare, Bot, AlertCircle } from 'lucide-react';

        // --- QUAN TRỌNG: ĐIỀN API KEY VÀO DÒNG DƯỚI ĐÂY ---
        const apiKey = "AIzaSyCd7pESM1p4TDxXnRvYHwyolSfx2f7qLS0"; // Ví dụ: "AIzaSyDxxxx..."

        // --- DỮ LIỆU 1: PH VÀ CÂY TRỒNG ---
        const PH_DATA = [
            { ph: 2, color: '#EE1C25', label: 'Axit cực mạnh', desc: 'Cần cải tạo đất nghiêm ngặt.', plants: [] },
            { ph: 3, color: '#F26724', label: 'Axit mạnh', desc: 'Đất phèn nặng.', plants: [
                { id: 'p3_1', name: 'Tràm', sciName: 'Melaleuca', info: 'Chịu được đất phèn, ngập mặn.', care: 'Tưới nước thường xuyên.', season: 'Quanh năm' },
                { id: 'p3_2', name: 'Dứa (Thơm)', sciName: 'Ananas comosus', info: 'Cây chịu phèn tốt miền Tây.', care: 'Bón kali để tăng độ ngọt.', season: 'Quanh năm' }
            ]},
            { ph: 4, color: '#F8C200', label: 'Axit', desc: 'Đất chua, cần bón vôi.', plants: [
                { id: 'p4_1', name: 'Chè (Trà)', sciName: 'Camellia sinensis', info: 'Cây công nghiệp chủ lực.', care: 'Đất tơi xốp, thoát nước tốt.', season: 'Quanh năm' },
                { id: 'p4_2', name: 'Khoai tây', sciName: 'Solanum tuberosum', info: 'Ưa đất tơi xốp.', care: 'Vun gốc cao.', season: 'Đông Xuân' }
            ]},
            { ph: 5, color: '#D1DB00', label: 'Axit nhẹ', desc: 'Phù hợp cây công nghiệp.', plants: [
                { id: 'p5_1', name: 'Cà phê', sciName: 'Coffea', info: 'Cây chủ lực Tây Nguyên.', care: 'Cần bóng râm, tưới đủ nước.', season: 'Tháng 10-12' },
                { id: 'p5_2', name: 'Khoai lang', sciName: 'Ipomoea batatas', info: 'Dễ trồng, chịu hạn.', care: 'Tránh ngập úng.', season: 'Quanh năm' },
                { id: 'p5_3', name: 'Thanh long', sciName: 'Hylocereus', info: 'Đặc sản Bình Thuận.', care: 'Chong đèn trái vụ.', season: 'Quanh năm' }
            ]},
            { ph: 6, color: '#8CC63F', label: 'Hơi chua (Lý tưởng)', desc: 'Lý tưởng cho đa số cây.', plants: [
                { id: 'p6_1', name: 'Lúa nước', sciName: 'Oryza sativa', info: 'Cây lương thực chính.', care: 'Quản lý nước theo giai đoạn.', season: 'Đông Xuân, Hè Thu' },
                { id: 'p6_2', name: 'Sầu riêng', sciName: 'Durio zibethinus', info: 'Vua trái cây.', care: 'Nhạy cảm nấm bệnh.', season: 'Hè' },
                { id: 'p6_3', name: 'Cam sành', sciName: 'Citrus reticulata', info: 'Cây có múi.', care: 'Phòng sâu vẽ bùa.', season: 'Cuối năm' },
                { id: 'p6_4', name: 'Xoài', sciName: 'Mangifera indica', info: 'Thích nghi rộng.', care: 'Kích thích ra hoa.', season: 'Hè' }
            ]},
            { ph: 7, color: '#00A651', label: 'Trung tính', desc: 'Dinh dưỡng cân bằng.', plants: [
                { id: 'p7_1', name: 'Ngô (Bắp)', sciName: 'Zea mays', info: 'Ngắn ngày, dễ trồng.', care: 'Cần nhiều nước khi trổ cờ.', season: 'Quanh năm' },
                { id: 'p7_2', name: 'Dưa hấu', sciName: 'Citrullus lanatus', info: 'Ưa nắng.', care: 'Cắt tỉa nhánh.', season: 'Xuân Hè' },
                { id: 'p7_3', name: 'Rau cải', sciName: 'Brassica', info: 'Rau ăn lá.', care: 'Giữ ẩm thường xuyên.', season: 'Đông Xuân' }
            ]},
            { ph: 8, color: '#009444', label: 'Hơi kiềm', desc: 'Chịu mặn nhẹ.', plants: [
                { id: 'p8_1', name: 'Dừa', sciName: 'Cocos nucifera', info: 'Chịu mặn tốt.', care: 'Bồi bùn sông hàng năm.', season: 'Quanh năm' },
                { id: 'p8_2', name: 'Nho', sciName: 'Vitis vinifera', info: 'Đặc sản Ninh Thuận.', care: 'Cắt tỉa cành.', season: '3 vụ/năm' },
                { id: 'p8_3', name: 'Tỏi', sciName: 'Allium sativum', info: 'Tỏi Lý Sơn.', care: 'Đất cát pha vôi.', season: 'Đông Xuân' }
            ]},
            { ph: 9, color: '#007F95', label: 'Kiềm nhẹ', desc: 'Đất vôi.', plants: [{ id: 'p9_1', name: 'Lựu', sciName: 'Punica granatum', info: 'Chịu hạn tốt.', care: 'Tạo tán.', season: 'Hè Thu' }]},
            { ph: 10, color: '#2E3092', label: 'Kiềm', desc: 'Ít cây trồng.', plants: [] },
            { ph: 11, color: '#4F469D', label: 'Kiềm mạnh', desc: 'Không phù hợp.', plants: [] },
            { ph: 12, color: '#662D91', label: 'Kiềm rất mạnh', desc: 'Cần xử lý.', plants: [] },
            { ph: 13, color: '#92278F', label: 'Kiềm cực mạnh', desc: 'Ngộ độc kiềm.', plants: [] },
            { ph: 14, color: '#BE1E2D', label: 'Ngoại lệ', desc: 'Cực đoan.', plants: [] },
        ];

        // --- DỮ LIỆU 2: CẢI TẠO ĐẤT ---
        const SOIL_ACID_TIPS = [
            { 
                title: "Bón vôi (Liming)", 
                icon: <Beaker />, 
                color: "bg-orange-100 text-orange-600",
                desc: "Biện pháp quan trọng nhất để nâng pH đất.",
                steps: ["Dùng vôi bột (CaCO3) hoặc vôi tôi (Ca(OH)2).", "Lượng bón tùy độ chua (trung bình 500-1000kg/ha).", "Rải đều và cày xới sâu vào đất."] 
            },
            { 
                title: "Bón Lân nung chảy", 
                icon: <Sprout />, 
                color: "bg-green-100 text-green-600",
                desc: "Phân lân nung chảy có tính kiềm, vừa cung cấp dinh dưỡng vừa khử chua.",
                steps: ["Thay thế Super Lân (tính axit) bằng Lân nung chảy.", "Bón lót trước khi trồng cây."] 
            },
            { 
                title: "Thủy lợi (Thau chua)", 
                icon: <Droplets />, 
                color: "bg-blue-100 text-blue-600",
                desc: "Dùng nước ngọt để đẩy nước chua (phèn) ra khỏi ruộng.",
                steps: ["Xây dựng hệ thống kênh tưới tiêu.", "Đưa nước ngọt vào ruộng ngâm, sau đó xả nước chua ra kênh tiêu."] 
            }
        ];

        const SOIL_ALKALINE_TIPS = [
            { 
                title: "Bón Thạch Cao (Gypsum)", 
                icon: <TestTube />, 
                color: "bg-purple-100 text-purple-600",
                desc: "Dùng CaSO4 để thay thế Natri trong đất kiềm bằng Canxi.",
                steps: ["Rải thạch cao nghiền nhỏ lên mặt đất.", "Cày xới và tưới nước đẫm để hòa tan thạch cao ngấm xuống tầng rễ."] 
            },
            { 
                title: "Bón Lưu Huỳnh (Sulfur)", 
                icon: <Wind />, 
                color: "bg-yellow-100 text-yellow-600",
                desc: "Lưu huỳnh bị oxy hóa tạo thành axit sunfuric giúp giảm pH.",
                steps: ["Bón bột lưu huỳnh nguyên chất.", "Hiệu quả chậm, cần thời gian (vài tháng) để vi sinh vật chuyển hóa."] 
            },
            { 
                title: "Sử dụng Phân bón tạo Axit", 
                icon: <Beaker />, 
                color: "bg-indigo-100 text-indigo-600",
                desc: "Tránh các loại phân gây kiềm hóa thêm.",
                steps: ["Sử dụng Amoni Sunfat ((NH4)2SO4) hoặc Urê.", "Tránh bón Canxi Nitrat."] 
            }
        ];

        const COMMON_SOIL_TIPS = [
            { 
                title: "Bổ sung Hữu cơ", 
                icon: <Leaf />, 
                color: "bg-green-50 text-green-700",
                desc: "Cải thiện cấu trúc đất đệm cho cả đất chua và kiềm.",
                steps: ["Sử dụng phân chuồng hoai mục, phân trùn quế.", "Bổ sung axit humic giúp rễ cây hấp thu dinh dưỡng tốt hơn trong điều kiện pH cực đoan."] 
            }
        ];

        // --- DỮ LIỆU 3: SÂU BỆNH PHỔ BIẾN ---
        const PEST_DATA = [
            {
                name: "Rầy Nâu",
                target: "Cây Lúa",
                symptom: "Rầy chích hút nhựa cây làm cây khô héo, cháy rầy (vàng úa). Có thể truyền bệnh virus vàng lùn, lùn xoắn lá.",
                fix: "Thăm đồng thường xuyên. Dùng giống kháng rầy. Phun thuốc đặc trị khi mật độ cao, không phun ngừa khi chưa có rầy.",
                severity: "Cao"
            },
            {
                name: "Bệnh Thối Rễ (Phytophthora)",
                target: "Sầu riêng, Bưởi, Cam",
                symptom: "Lá vàng úa, rụng dần. Vỏ gốc cây bị thối, chảy nhựa. Rễ cái bị thối đen không hút được nước.",
                fix: "Xẻ rãnh thoát nước tốt, không để ngập úng. Quét thuốc gốc đồng (Bordeaux) vào vết bệnh. Bón nấm đối kháng Trichoderma.",
                severity: "Rất cao"
            },
            {
                name: "Sâu Đục Thân",
                target: "Ngô, Cây ăn quả",
                symptom: "Cây bị héo ngọn (dẻo). Thân cây có lỗ đục, đùn phân mùn cưa ra ngoài. Gió dễ làm gãy thân.",
                fix: "Vệ sinh đồng ruộng sau thu hoạch. Dùng bẫy đèn bắt bướm. Cắt bỏ cành sâu và tiêu hủy.",
                severity: "Trung bình"
            },
            {
                name: "Bệnh Phấn Trắng",
                target: "Bầu, Bí, Dưa, Hoa hồng",
                symptom: "Xuất hiện lớp bột màu trắng như phấn bao phủ trên mặt lá. Lá bị xoăn, khô và rụng sớm.",
                fix: "Tỉa cành tạo độ thông thoáng. Cắt bỏ lá bệnh. Phun thuốc có hoạt chất Sulfur hoặc Carbendazim.",
                severity: "Thấp"
            },
            {
                name: "Bệnh Thán Thư",
                target: "Xoài, Ớt, Cà phê",
                symptom: "Trên lá và quả xuất hiện các đốm tròn màu nâu đen, lõm xuống. Làm thối quả, rụng hoa.",
                fix: "Không trồng quá dày. Bón cân đối NPK. Phun thuốc phòng trừ vào giai đoạn ra hoa và đậu quả non.",
                severity: "Cao"
            }
        ];

        // --- AI ASSISTANT COMPONENT (Gemini Powered) ---
        const AIAssistant = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { role: 'model', text: 'Xin chào bà con! Tôi là Trợ lý AI Nông nghiệp. Bà con cần hỏi gì về cây trồng, đất đai hay sâu bệnh không ạ?' }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null); // Thêm state lỗi
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isOpen]);

            const handleSend = async () => {
                if (!input.trim()) return;
                
                // Reset lỗi trước khi gửi
                setError(null);

                // Kiểm tra Key trước
                if (!apiKey || apiKey.length < 10) {
                    setError("Lỗi: Bạn chưa điền API Key vào code (dòng 58). Hãy mở file index.html và điền key nhé.");
                    return;
                }

                const userMessage = { role: 'user', text: input };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setIsLoading(true);

                try {
                    // Sử dụng model gemini-1.5-flash ổn định hơn
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: `Bạn là một chuyên gia nông nghiệp Việt Nam thân thiện tên là "Trợ lý Green-Note". Hãy trả lời ngắn gọn, súc tích, dễ hiểu cho nông dân Việt Nam về các vấn đề nông nghiệp. Câu hỏi của người dùng: ${input}`
                                    }]
                                }]
                            }),
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error("API Error:", errorData);
                        throw new Error(errorData.error?.message || "Lỗi kết nối đến Google AI");
                    }

                    const data = await response.json();
                    
                    if (!data.candidates || data.candidates.length === 0) {
                         throw new Error("AI không trả lời được câu hỏi này (An toàn/Chặn).");
                    }

                    const aiResponseText = data.candidates[0].content.parts[0].text;
                    setMessages(prev => [...prev, { role: 'model', text: aiResponseText }]);

                } catch (err) {
                    console.error("Fetch Error:", err);
                    setMessages(prev => [...prev, { role: 'model', text: '⚠️ Xin lỗi, có lỗi xảy ra. Bà con kiểm tra lại kết nối mạng hoặc API Key nhé.' }]);
                    setError(err.message); // Hiển thị lỗi chi tiết ra UI
                } finally {
                    setIsLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') handleSend();
            };

            return (
                <>
                    {/* Floating Action Button */}
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="fixed bottom-6 right-6 z-50 p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-full shadow-2xl hover:scale-110 transition-transform duration-300 border-4 border-white/20 flex items-center justify-center group"
                    >
                        {isOpen ? <X size={28} /> : <Sparkles size={28} className="animate-pulse" />}
                        {!isOpen && (
                            <span className="absolute right-full mr-3 bg-slate-800 text-white text-xs font-bold px-3 py-1 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                Hỏi Trợ lý AI ✨
                            </span>
                        )}
                    </button>

                    {/* Chat Window */}
                    {isOpen && (
                        <div className="fixed bottom-24 right-6 z-50 w-[90vw] md:w-96 h-[60vh] md:h-[500px] bg-white rounded-2xl shadow-2xl border border-slate-100 flex flex-col overflow-hidden animate-fade-in">
                            {/* Header */}
                            <div className="bg-gradient-to-r from-green-600 to-emerald-600 p-4 flex items-center gap-3 text-white">
                                <div className="p-2 bg-white/20 rounded-full">
                                    <Bot size={24} />
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg">Trợ lý Nhà Nông AI</h3>
                                    <div className="flex items-center gap-1 text-xs text-green-100">
                                        <span className="w-2 h-2 bg-green-300 rounded-full animate-pulse"></span>
                                        Đang hoạt động
                                    </div>
                                </div>
                            </div>

                            {/* Messages Area */}
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50">
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[80%] p-3 rounded-2xl chat-bubble text-sm leading-relaxed shadow-sm ${
                                            msg.role === 'user' 
                                            ? 'bg-green-600 text-white rounded-tr-none' 
                                            : 'bg-white text-slate-700 rounded-tl-none border border-slate-200'
                                        }`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                {isLoading && (
                                    <div className="flex justify-start">
                                        <div className="bg-white p-3 rounded-2xl rounded-tl-none border border-slate-200 flex gap-1">
                                            <span className="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></span>
                                            <span className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></span>
                                            <span className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></span>
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            {/* Error Alert Area */}
                            {error && (
                                <div className="px-4 py-2 bg-red-50 border-t border-red-100 text-red-600 text-xs flex items-center gap-2">
                                    <AlertCircle size={14} className="flex-shrink-0"/>
                                    <span>{error}</span>
                                </div>
                            )}

                            {/* Input Area */}
                            <div className="p-3 bg-white border-t border-slate-100">
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={input}
                                        onChange={(e) => setInput(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="Nhập câu hỏi của bạn..."
                                        className="flex-1 border border-slate-200 rounded-xl px-4 py-2 focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500 text-sm"
                                    />
                                    <button
                                        onClick={handleSend}
                                        disabled={isLoading}
                                        className="p-2 bg-green-600 text-white rounded-xl hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                    >
                                        <Send size={20} />
                                    </button>
                                </div>
                                <p className="text-[10px] text-slate-400 text-center mt-2">
                                    *AI có thể mắc lỗi. Hãy kiểm chứng thông tin quan trọng.
                                </p>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        const PHSpectrumCard = ({ data, onClick }) => (
            <button
                onClick={() => onClick(data)}
                style={{ backgroundColor: data.color }}
                className="group relative w-full h-32 md:h-40 flex flex-col items-center justify-center transition-all duration-300 hover:z-10 hover:scale-[1.05] hover:shadow-2xl focus:outline-none"
            >
                <div className="text-center z-10 transform transition-transform duration-300 group-hover:-translate-y-1">
                    <span className="block text-3xl md:text-4xl font-extrabold text-white text-shadow tracking-tight">{data.ph}</span>
                    <span className="block text-[10px] md:text-xs font-bold text-white/90 uppercase tracking-widest mt-1 text-shadow">{data.label}</span>
                </div>
                <div className="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div className="absolute bottom-2 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 text-white">
                    <ArrowRight size={16} />
                </div>
            </button>
        );

        // --- MÀN HÌNH LANDING PAGE (TRANG CHỦ) ---
        const LandingView = ({ onNavigate }) => (
            <div className="animate-fade-in max-w-5xl mx-auto px-4 py-12 flex flex-col items-center justify-center min-h-[80vh]">
                <div className="text-center mb-12">
                    <div className="inline-flex items-center justify-center p-5 bg-green-50 rounded-full shadow-sm mb-6 animate-bounce-slow">
                        <Leaf className="text-green-600 w-16 h-16" />
                    </div>
                    <h1 className="text-4xl md:text-6xl font-extrabold text-slate-800 mb-4 tracking-tight">
                        Chào bạn,
                    </h1>
                    <p className="text-xl md:text-2xl text-slate-500 font-light">
                        Bạn đang cần tìm thông tin về vấn đề gì?
                    </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                    {/* Card 1 */}
                    <button 
                        onClick={() => onNavigate('ph_lookup')}
                        className="group bg-white p-8 rounded-3xl shadow-md hover:shadow-2xl border border-slate-100 transition-all duration-300 flex flex-col items-center text-center hover:-translate-y-2"
                    >
                        <div className="w-20 h-20 bg-blue-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-100 transition-colors">
                            <TestTube className="w-10 h-10 text-blue-600" />
                        </div>
                        <h3 className="text-xl font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition-colors">Cây trồng theo độ pH</h3>
                        <p className="text-slate-500 text-sm">Tra cứu các loại cây phù hợp nhất với từng mức độ pH của đất.</p>
                    </button>

                    {/* Card 2 */}
                    <button 
                        onClick={() => onNavigate('soil')}
                        className="group bg-white p-8 rounded-3xl shadow-md hover:shadow-2xl border border-slate-100 transition-all duration-300 flex flex-col items-center text-center hover:-translate-y-2"
                    >
                        <div className="w-20 h-20 bg-amber-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-amber-100 transition-colors">
                            <Shovel className="w-10 h-10 text-amber-600" />
                        </div>
                        <h3 className="text-xl font-bold text-slate-800 mb-2 group-hover:text-amber-600 transition-colors">Cải tạo đất</h3>
                        <p className="text-slate-500 text-sm">Phương pháp xử lý đất chua (Axit) và đất Kiềm hiệu quả.</p>
                    </button>

                    {/* Card 3 */}
                    <button 
                        onClick={() => onNavigate('pest')}
                        className="group bg-white p-8 rounded-3xl shadow-md hover:shadow-2xl border border-slate-100 transition-all duration-300 flex flex-col items-center text-center hover:-translate-y-2"
                    >
                        <div className="w-20 h-20 bg-red-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-red-100 transition-colors">
                            <Bug className="w-10 h-10 text-red-600" />
                        </div>
                        <h3 className="text-xl font-bold text-slate-800 mb-2 group-hover:text-red-600 transition-colors">Sâu bệnh phổ biến</h3>
                        <p className="text-slate-500 text-sm">Nhận biết dấu hiệu bệnh và cách phòng trừ kịp thời.</p>
                    </button>
                </div>
            </div>
        );

        // --- MÀN HÌNH CẢI TẠO ĐẤT (UPDATE) ---
        const SoilImprovementView = () => {
            const SoilCard = ({ tip }) => (
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-md transition-all">
                    <div className="flex items-start gap-4 mb-3">
                        <div className={`p-3 rounded-xl ${tip.color} flex-shrink-0`}>
                            {React.cloneElement(tip.icon, { size: 24 })}
                        </div>
                        <div>
                            <h4 className="text-lg font-bold text-slate-800">{tip.title}</h4>
                            <p className="text-sm text-slate-500">{tip.desc}</p>
                        </div>
                    </div>
                    <div className="bg-slate-50 rounded-lg p-4 text-sm text-slate-600">
                        <ul className="space-y-2">
                            {tip.steps.map((step, idx) => (
                                <li key={idx} className="flex items-start gap-2">
                                    <span className="mt-1.5 w-1.5 h-1.5 bg-slate-400 rounded-full flex-shrink-0"></span>
                                    {step}
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>
            );

            return (
                <div className="animate-fade-in max-w-6xl mx-auto px-4 pb-20 pt-6">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl md:text-4xl font-bold text-slate-800 mb-4 flex items-center justify-center gap-3">
                            <Shovel className="text-amber-600" size={32} />
                            Kỹ Thuật <span className="text-amber-600">Cải Tạo Đất</span>
                        </h2>
                        <p className="text-slate-500 max-w-2xl mx-auto">Phân loại và áp dụng đúng phương pháp cho từng loại đất.</p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* Cột 1: Đất Axit */}
                        <div className="space-y-6">
                            <div className="bg-orange-50 p-6 rounded-3xl border border-orange-100">
                                <h3 className="text-2xl font-bold text-orange-800 mb-4 flex items-center gap-2">
                                    <ArrowRight className="bg-orange-200 rounded-full p-1" /> Đất Chua (Axit)
                                </h3>
                                <p className="text-orange-700/80 mb-6 text-sm">Thường gặp ở đất phèn, đất dốc rửa trôi, đất canh tác lâu năm. pH thấp &lt; 5.5.</p>
                                <div className="space-y-4">
                                    {SOIL_ACID_TIPS.map((tip, idx) => <SoilCard key={idx} tip={tip} />)}
                                </div>
                            </div>
                        </div>

                        {/* Cột 2: Đất Kiềm & Chung */}
                        <div className="space-y-6">
                            <div className="bg-purple-50 p-6 rounded-3xl border border-purple-100">
                                <h3 className="text-2xl font-bold text-purple-800 mb-4 flex items-center gap-2">
                                    <ArrowRight className="bg-purple-200 rounded-full p-1" /> Đất Kiềm
                                </h3>
                                <p className="text-purple-700/80 mb-6 text-sm">Thường gặp ở vùng đất vôi, vùng khô hạn ít mưa. pH cao &gt; 7.5.</p>
                                <div className="space-y-4">
                                    {SOIL_ALKALINE_TIPS.map((tip, idx) => <SoilCard key={idx} tip={tip} />)}
                                </div>
                            </div>

                             <div className="bg-green-50 p-6 rounded-3xl border border-green-100">
                                <h3 className="text-xl font-bold text-green-800 mb-4">Biện pháp chung</h3>
                                <div className="space-y-4">
                                    {COMMON_SOIL_TIPS.map((tip, idx) => <SoilCard key={idx} tip={tip} />)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const PestDiseaseView = () => (
            <div className="animate-fade-in max-w-5xl mx-auto px-4 pb-20 pt-6">
                <div className="text-center mb-12">
                    <h2 className="text-3xl md:text-4xl font-bold text-slate-800 mb-4 flex items-center justify-center gap-3">
                        <Bug className="text-red-500" size={32} />
                        Phòng Trừ <span className="text-red-500">Sâu Bệnh</span>
                    </h2>
                    <p className="text-slate-500 max-w-2xl mx-auto">Nhận biết sớm các dấu hiệu bệnh để có biện pháp xử lý kịp thời, bảo vệ năng suất cây trồng.</p>
                </div>

                <div className="space-y-6">
                    {PEST_DATA.map((pest, index) => (
                        <div key={index} className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition-shadow">
                            <div className="flex flex-col md:flex-row">
                                <div className="bg-slate-50 p-6 md:w-1/4 border-b md:border-b-0 md:border-r border-slate-100 flex flex-col justify-center items-center text-center">
                                    <div className="w-16 h-16 bg-white rounded-full shadow-sm flex items-center justify-center text-red-500 mb-3">
                                        <ShieldAlert size={32} />
                                    </div>
                                    <h3 className="text-lg font-bold text-slate-800">{pest.name}</h3>
                                    <span className="text-xs font-medium text-slate-400 mt-1">{pest.target}</span>
                                    <span className={`mt-3 px-3 py-1 rounded-full text-xs font-bold ${pest.severity === 'Rất cao' ? 'bg-red-100 text-red-600' : pest.severity === 'Cao' ? 'bg-orange-100 text-orange-600' : 'bg-yellow-100 text-yellow-600'}`}>
                                        Nguy hiểm: {pest.severity}
                                    </span>
                                </div>
                                <div className="p-6 md:w-3/4 grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 className="text-red-600 font-bold mb-2 flex items-center gap-2">
                                            <Search size={18} /> Dấu hiệu nhận biết
                                        </h4>
                                        <p className="text-slate-600 text-sm leading-relaxed bg-red-50/50 p-3 rounded-lg border border-red-50">
                                            {pest.symptom}
                                        </p>
                                    </div>
                                    <div>
                                        <h4 className="text-green-600 font-bold mb-2 flex items-center gap-2">
                                            <Shovel size={18} /> Cách khắc phục
                                        </h4>
                                        <p className="text-slate-600 text-sm leading-relaxed bg-green-50/50 p-3 rounded-lg border border-green-50">
                                            {pest.fix}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const PlantCard = ({ plant, onClick, color }) => (
            <div 
                onClick={() => onClick(plant)}
                className="bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl border border-slate-100 transition-all duration-300 cursor-pointer group flex flex-col h-full relative overflow-hidden hover:-translate-y-1"
            >
                <div className="absolute top-0 right-0 w-24 h-24 rounded-bl-full opacity-10 group-hover:opacity-20 transition-opacity" style={{ backgroundColor: color }}></div>
                <div className="flex items-start justify-between mb-4 z-10">
                    <div className="p-3 rounded-xl bg-green-50 text-green-600 group-hover:bg-green-100 transition-colors">
                        <Sprout size={28} />
                    </div>
                </div>
                <h3 className="font-bold text-xl text-slate-800 mb-1 group-hover:text-green-600 transition-colors z-10">{plant.name}</h3>
                <p className="text-sm text-slate-400 italic mb-6 z-10">{plant.sciName}</p>
                <div className="mt-auto z-10 pt-4 border-t border-slate-50">
                    <span className="text-sm font-bold text-green-600 flex items-center gap-2 group-hover:gap-3 transition-all">
                        Xem chi tiết <ArrowRight size={16} />
                    </span>
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            // View mặc định là 'landing'
            const [view, setView] = useState('landing'); 
            const [selectedPH, setSelectedPH] = useState(null);
            const [selectedPlant, setSelectedPlant] = useState(null);
            const [loading, setLoading] = useState(false);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

            // Navigation Logic
            const navigateTo = (targetView) => {
                setLoading(true);
                setIsMobileMenuOpen(false);
                setTimeout(() => {
                    setView(targetView);
                    window.scrollTo(0, 0);
                    setLoading(false);
                }, 200);
            };

            const handlePHClick = (ph) => {
                setSelectedPH(ph);
                navigateTo('list');
            };

            const handlePlantClick = (plant) => {
                setSelectedPlant(plant);
                navigateTo('detail');
            };

            // Views Renderers
            const renderPHLookup = () => (
                <div className="animate-fade-in w-full">
                     <div className="text-center py-8 px-4">
                        <h2 className="text-3xl md:text-4xl font-bold text-slate-800 mb-2 flex items-center justify-center gap-2">
                            <TestTube className="text-blue-600" />
                            Thang Đo <span className="text-blue-600">pH Đất</span>
                        </h2>
                        <p className="text-slate-500">Chọn màu sắc tương ứng với đất của bạn</p>
                    </div>
                    <div className="w-full max-w-7xl mx-auto pb-20">
                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-7 gap-1 px-1">
                            {PH_DATA.map((item) => (
                                <PHSpectrumCard key={item.ph} data={item} onClick={handlePHClick} />
                            ))}
                        </div>
                        <div className="text-center mt-8 text-slate-400 italic text-sm">
                            * Bảng màu mô phỏng thang đo pH chuẩn
                        </div>
                    </div>
                </div>
            );

            // ... (Giữ nguyên renderList, renderDetail) ...
            const renderList = () => (
                <div className="animate-slide-up max-w-6xl mx-auto px-4 py-8 pb-20">
                    <div className="rounded-3xl p-10 shadow-lg mb-12 text-white relative overflow-hidden flex flex-col md:flex-row items-center gap-10" style={{ backgroundColor: selectedPH.color }}>
                        <div className="absolute inset-0 bg-black/10"></div>
                        <div className="absolute -right-20 -top-20 w-80 h-80 bg-white/20 rounded-full blur-3xl"></div>
                        <div className="relative z-10 flex flex-col items-center md:items-start text-center md:text-left">
                            <div className="text-sm font-bold uppercase tracking-widest opacity-80 mb-2">Kết quả phân tích</div>
                            <div className="flex items-baseline gap-4 mb-4">
                                <span className="text-7xl font-extrabold">pH {selectedPH.ph}</span>
                            </div>
                            <h2 className="text-3xl font-bold mb-3">{selectedPH.label}</h2>
                            <p className="text-lg opacity-90 max-w-xl leading-relaxed">{selectedPH.desc}</p>
                        </div>
                    </div>
                    <div className="flex items-center justify-between mb-8 border-b border-slate-200 pb-4">
                        <h3 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                            <Search className="text-green-600" size={24} />
                            Cây trồng đề xuất
                            <span className="text-sm font-normal text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
                                {selectedPH.plants.length} kết quả
                            </span>
                        </h3>
                    </div>
                    {selectedPH.plants.length > 0 ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            {selectedPH.plants.map((plant) => (
                                <PlantCard key={plant.id} plant={plant} onClick={handlePlantClick} color={selectedPH.color} />
                            ))}
                        </div>
                    ) : (
                        <div className="text-center py-20 bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200">
                            <div className="w-20 h-20 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Wind className="w-10 h-10 text-slate-400" />
                            </div>
                            <h4 className="text-xl font-bold text-slate-700 mb-2">Chưa có dữ liệu phù hợp</h4>
                            <p className="text-slate-500 max-w-md mx-auto">Độ pH này khá khắc nghiệt. Hãy tham khảo mục "Cải tạo đất".</p>
                        </div>
                    )}
                </div>
            );

            const renderDetail = () => (
                <div className="animate-fade-in max-w-4xl mx-auto px-4 py-8 pb-20">
                    <div className="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-100">
                        <div className="p-10 md:p-12 relative overflow-hidden bg-slate-900 text-white">
                            <div className="absolute top-0 right-0 p-12 opacity-10 transform translate-x-10 -translate-y-10">
                                <Leaf size={240} />
                            </div>
                            <div className="relative z-10">
                                <div className="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-2 rounded-full border border-white/10 mb-6">
                                    <div className="w-3 h-3 rounded-full shadow-sm" style={{backgroundColor: selectedPH.color}}></div>
                                    <span className="text-sm font-semibold">Phù hợp pH {selectedPH.ph}</span>
                                </div>
                                <h1 className="text-4xl md:text-5xl font-extrabold mb-3 tracking-tight">{selectedPlant.name}</h1>
                                <p className="text-2xl text-slate-400 italic font-light font-serif">{selectedPlant.sciName}</p>
                            </div>
                        </div>
                        <div className="p-8 md:p-12 space-y-10">
                            <div>
                                <h3 className="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                                    <Info className="text-green-600" size={24} /> Thông tin tổng quan
                                </h3>
                                <p className="text-slate-600 leading-relaxed text-lg bg-slate-50 p-6 rounded-2xl border border-slate-100">{selectedPlant.info}</p>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="bg-green-50 p-8 rounded-3xl border border-green-100">
                                    <h3 className="text-green-800 font-bold flex items-center gap-3 mb-4 text-lg">
                                        <Droplets size={20} /> Kỹ thuật chăm sóc
                                    </h3>
                                    <p className="text-slate-700 leading-relaxed">{selectedPlant.care}</p>
                                </div>
                                <div className="bg-orange-50 p-8 rounded-3xl border border-orange-100">
                                    <h3 className="text-orange-800 font-bold flex items-center gap-3 mb-4 text-lg">
                                        <Calendar size={20} /> Thời vụ canh tác
                                    </h3>
                                    <p className="text-slate-700 leading-relaxed">{selectedPlant.season}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-white text-slate-800 font-sans flex flex-col">
                    {/* Navbar */}
                    <nav className="sticky top-0 z-50 bg-white/90 backdrop-blur-xl border-b border-slate-100 shadow-sm transition-all duration-300">
                        <div className="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
                            {/* Left: Logo & Back */}
                            <div className="flex items-center gap-4">
                                {(view !== 'landing') && (
                                    <button onClick={() => navigateTo(view === 'detail' ? 'list' : 'landing')} className="p-3 rounded-full hover:bg-slate-100 text-slate-600 transition-colors group">
                                        {view === 'landing' ? <Home size={24} /> : <ChevronLeft size={24} className="group-hover:-translate-x-1 transition-transform" />}
                                    </button>
                                )}
                                <div className="flex items-center gap-3 cursor-pointer select-none" onClick={() => navigateTo('landing')}>
                                    <Leaf className="text-green-600 fill-green-600" size={28} />
                                    <span className="text-2xl font-logo text-green-700 pt-1">Green-Note</span>
                                </div>
                            </div>

                            {/* Desktop Menu */}
                            <div className="hidden md:flex items-center gap-1">
                                <button onClick={() => navigateTo('ph_lookup')} className={`px-4 py-2 rounded-full font-medium transition-colors ${view === 'ph_lookup' || view === 'list' || view === 'detail' ? 'bg-green-50 text-green-700' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    Tra cứu pH
                                </button>
                                <button onClick={() => navigateTo('soil')} className={`px-4 py-2 rounded-full font-medium transition-colors ${view === 'soil' ? 'bg-green-50 text-green-700' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    Cải tạo đất
                                </button>
                                <button onClick={() => navigateTo('pest')} className={`px-4 py-2 rounded-full font-medium transition-colors ${view === 'pest' ? 'bg-green-50 text-green-700' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    Sâu bệnh
                                </button>
                            </div>

                            {/* Mobile Menu Button */}
                            <button className="md:hidden p-2 text-slate-600" onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}>
                                {isMobileMenuOpen ? <X /> : <Menu />}
                            </button>
                        </div>

                        {/* Mobile Menu Dropdown */}
                        {isMobileMenuOpen && (
                            <div className="md:hidden absolute top-20 left-0 w-full bg-white border-b border-slate-100 shadow-lg animate-fade-in">
                                <div className="flex flex-col p-4 gap-2">
                                    <button onClick={() => navigateTo('landing')} className="p-4 rounded-xl bg-slate-50 text-left font-semibold text-slate-700 flex items-center gap-2"><Home size={18}/> Trang chủ</button>
                                    <button onClick={() => navigateTo('ph_lookup')} className="p-4 rounded-xl bg-slate-50 text-left font-semibold text-slate-700 flex items-center gap-2"><TestTube size={18}/> Tra cứu pH</button>
                                    <button onClick={() => navigateTo('soil')} className="p-4 rounded-xl bg-slate-50 text-left font-semibold text-slate-700 flex items-center gap-2"><Shovel size={18}/> Cải tạo đất</button>
                                    <button onClick={() => navigateTo('pest')} className="p-4 rounded-xl bg-slate-50 text-left font-semibold text-slate-700 flex items-center gap-2"><Bug size={18}/> Sâu bệnh</button>
                                </div>
                            </div>
                        )}
                    </nav>

                    {/* Main Content */}
                    <main className="flex-grow relative">
                        {loading ? (
                            <div className="flex flex-col items-center justify-center h-[60vh] animate-pulse">
                                <div className="w-16 h-16 border-4 border-green-200 border-t-green-600 rounded-full animate-spin mb-6"></div>
                                <span className="text-slate-400 font-medium">Đang tải dữ liệu...</span>
                            </div>
                        ) : (
                            <>
                                {view === 'landing' && <LandingView onNavigate={navigateTo} />}
                                {view === 'ph_lookup' && renderPHLookup()}
                                {view === 'list' && renderList()}
                                {view === 'detail' && renderDetail()}
                                {view === 'soil' && <SoilImprovementView />}
                                {view === 'pest' && <PestDiseaseView />}
                            </>
                        )}
                        
                        {/* GEMINI AI ASSISTANT BUTTON & MODAL */}
                        <AIAssistant />
                    </main>

                    {/* Footer */}
                    <footer className="py-10 text-center border-t border-slate-100 bg-slate-50">
                        <p className="text-slate-500 text-sm font-medium">© 2024 Green-Note. Vì một nền nông nghiệp xanh.</p>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
